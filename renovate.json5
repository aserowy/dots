{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended"
  ],
  "customManagers": [
    {
      "customType": "regex",
      "managerFilePatterns": ["**/*.nix"],
      "matchStrings": [
        "\\s*image = \".+?:(?<currentValue>.+?)\"; # (?<datasource>.+?)\/(?<depName>.+?)@(?<versioning>.*)"
      ]
    },
    {
      "customType": "regex",
      "managerFilePatterns": ["cluster/charts/**/*.nix"],
      "matchStrings": [
        "repo\\s*=\\s*\"(?<registryUrl>.*?)\".*?\\n.*?chart\\s*=\\s*\"(?<depName>.*?)\".*?\\n.*?version\\s*=\\s*\"(?<currentValue>.*?)\".*?"
      ],
      "datasourceTemplate": "helm"
    }
  ],
  "postUpgradeTasks": {
    "allowedCommands": ["bash"],
    "commands": [
      "bash ./.github/update-nixhelm-sha.sh {file}"
    ],
    "fileFilters": [
      "cluster/charts/**/*.nix"
    ]
  }
}

